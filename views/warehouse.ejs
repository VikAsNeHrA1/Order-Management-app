<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Current Orders</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.0-alpha1/dist/css/bootstrap.min.css" rel="stylesheet">
<link href="https://fonts.googleapis.com/css?family=Open+Sans:400,700" rel="stylesheet">


<style>
  body {
      font-family: 'Open Sans', sans-serif;
      margin: 0;
      padding: 0;
      background-color: #333;
      color: white;
      display: flex;
      flex-direction: column;
      min-height: 100vh;
  }

  .main-content {
      background-color: #333;
      padding: 20px 0;
      flex: 1 0 auto;
  }

  nav {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 20px 5%; /* Changed from fixed padding to percentage */
      background-color: #222; /* Added for contrast */
  }

  nav a {
      color: white;
      text-decoration: none;
      font-weight: bold;
      padding: 5px 10px; /* Spacing for better touch target */
  }

  nav a:hover {
      background-color: #555; /* Hover effect for links */
  }

  main {
      padding: 20px 5%; /* Consistent padding */
  }

  table {
      width: 100%; /* Table takes full width */
      text-align: center; /* Text centered */
      border-collapse: collapse;
  }

  .table-dark td, .table-dark th {
      border: 1px solid #555; /* Lighter border color for readability */
  }

  button {
      padding: 10px 20px; /* Adjusted button size */
      margin: 5px; /* Spacing between buttons */
      border-radius: 5px; /* Reduced border radius for a modern look */
  }

  footer {
      flex-shrink: 0;
      padding: 20px 5%; /* Consistent padding */
      background-color: #222; /* Footer background for contrast */
  }

  #footer-image {
      max-width: 100%;
      height: auto;
      margin-top: 20px; /* Spacing above the footer image */
  }
</style>
</head>
<body>
  <header>
    <nav>
        <div class="logo"><img src="https://www.101distributorsga.com/images/header/logo.png" alt="Logo"></div>
        <ul class="d-flex gap-3"> <!-- Bootstrap utility classes for layout and spacing -->
            <li><a href="#">Home</a></li>
            <li><a href="#">Gallery</a></li>
            <li><a href="#">About us</a></li>
            <li><a href="#">Contact</a></li>
        </ul>
    </nav>
</header>
<div class="main-content">
    <main>
        <h1 class="text-center mb-4">Current Orders</h1>
        <div class="container">
          <table class="table table-dark table-bordered table-hover">
            <thead>
              <tr>
                <th>Store Name</th>
                <th>Order List</th>
                <th>Action</th>
                <th>Status</th>
              </tr>
            </thead>
            <tbody>
              <% orders.forEach(order => { %>
                <tr>
                  <td><%= order.storeName %></td>
                  <td>
                    <% if (Array.isArray(order.orderList)) { %>
                      <table> <!-- Nested table to display orderList -->
                        <thead>
                          <tr>
                            <th>Item Name</th>
                            <th>Item Quantity</th>
                          </tr>
                        </thead>
                        <tbody>
                          <% order.orderList.forEach(item => { %>
                            <tr>
                              <td><%= item.itemName %></td>
                              <td><%= item.itemQuantity %></td>
                            </tr>
                          <% }); %>
                        </tbody>
                      </table>
                    <% } else { %>
                      <!-- Handle the case when orderList is not an array -->
                      <%= order.orderList %>
                    <% } %>
                  </td>
                  <td>
                    <button onclick="printOrder('<%= order.storeName %>', '<%= JSON.stringify(order.orderList) %>')">Print</button> |
                    <form action="/orders/delete/<%= order._id %>" method="post" style="display:inline;">
                      <button type="submit">Delete</button>
                    </form>
                    <!-- Add the code for sending order status here -->
                  </td>
                  <td>
                    <select onchange="updateOrderStatus('<%= order._id %>', this.value)">
                      <option value="New" <%= order.status === "New" ? 'selected' : '' %>>New</option>
                      <option value="In Progress" <%= order.status === "In Progress" ? 'selected' : '' %>>In Progress</option>
                    </select>
                  </td>
                </tr>
              <% }); %>
            </tbody>
          </table>
        </div>
      </main>
      
      
    <footer>
      <img src="https://github.com/VikAsNeHrA1/Order-Management-app/blob/main/views/footer.png?raw=true" alt="Footer Image" id="footer-image">
  </footer>
   <script>

     function printOrder(storeName, orderList) {
      const printWindow = window.open('', '_blank');
      printWindow.document.write('<html><head><title>Print Order</title></head><body>');
      printWindow.document.write('<h1>Order for ' + storeName + '</h1>');
      printWindow.document.write('<p>' + orderList + '</p>');
      printWindow.document.write('</body></html>');
      printWindow.document.close();
      printWindow.print();

      function updateOrderStatus(orderId, newStatus) {
    fetch(`/orders/update/${orderId}`, {
        method: 'POST',
        headers: {
            'Content-Type': 'application/json'
        },
        body: JSON.stringify({ status: newStatus })
    })
    .then(response => {
        if (!response.ok) {
            throw new Error('Network response was not ok');
        }
        return response.json();
    })
    .then(data => {
        if (!data.success) {
            alert('Error updating order status');
        }
       
        location.reload();
    })
    .catch(error => {
        console.error('Error:', error);
    });
}

  }


   </script>
  


</body>
</html>